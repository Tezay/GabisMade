{% extends "base.html" %}

{% block title %}Confirmation de R√©servation - GabisMade{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/order_receipt.css') }}">
{% endblock %}

{% block content %}
<div class="receipt-container">
    <div class="receipt-icon">üéâ</div>
    <div class="receipt-header">
        <h1>R√©servation Confirm√©e !</h1>
        <p>Merci d'avoir choisi GabisMade. Votre commande a bien √©t√© enregistr√©e.</p>
    </div>

    <div class="order-details">
        <h3>D√©tails de votre r√©servation</h3>
        <div class="detail-item">
            <strong>Num√©ro de commande :</strong> {{ order.order_number }}
        </div>
        <div class="detail-item">
            <strong>Date de r√©servation :</strong> {{ order.created_at.strftime('%d/%m/%Y √† %H:%M') }}
        </div>
        {% if order.pickup_slot %}
        <div class="detail-item">
            <strong>Cr√©neau de retrait :</strong> {{ order.pickup_slot.slot_datetime.strftime('%A %d %B %Y √† %Hh%M')|capitalize }}
        </div>
        <div class="detail-item">
            <strong>Lieu de retrait :</strong> {{ order.pickup_slot.location }}
        </div>
        {% else %}
        <div class="detail-item">
            <strong>Cr√©neau de retrait :</strong> Non sp√©cifi√©
        </div>
        {% endif %}
        <div class="detail-item">
            <strong>Total √† r√©gler au retrait :</strong> <span style="color: var(--accent-color); font-weight: bold;">{{ "%.2f"|format(order.total_price) }}‚Ç¨</span>
        </div>

        <div class="order-items-summary">
            <h4>Articles r√©serv√©s :</h4>
            <ul>
                {% for item in order.items %}
                <li>{{ item.product.name }} (x{{ item.quantity }})</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="contact-info">
        <p>N'oubliez pas de vous pr√©senter au lieu et √† l'heure convenus pour r√©cup√©rer vos produits frais.</p>
        <p>En cas de besoin ou pour toute question, contactez-nous au : <strong>07 68 21 01 00</strong>.</p>
    </div>

    <div class="actions">
        <a href="{{ url_for('main.home') }}" class="btn-home">Retour √† l'accueil</a>
        <a href="{{ url_for('main.my_orders') }}" style="margin-left: 1rem;">Voir mes commandes</a>

        {% if g.user_is_admin and order.status == 'confirmed' %}
        <form action="{{ url_for('main.admin_complete_order_route', order_number=order.order_number) }}" method="POST" style="display: inline-block; margin-left: 1rem;">
            <button type="submit" class="btn btn-success" style="background-color: var(--success-color); color: white; padding: 0.8rem 1.5rem; border-radius: 25px; font-size: 1rem; font-weight: 600; border: none; cursor: pointer;">
                Marquer comme termin√©e
            </button>
        </form>
        {% endif %}

        {% if g.user_is_admin and order.status == 'confirmed' %}
        <button type="button" id="deleteOrderBtn" class="btn btn-danger" style="margin-left: 1rem; background-color: var(--danger-color); color: white; padding: 0.8rem 1.5rem; border-radius: 25px; font-size: 1rem; font-weight: 600; border: none; cursor: pointer;">
            Supprimer cette commande
        </button>
        <form id="deleteOrderForm" action="{{ url_for('main.delete_order_route', order_number=order.order_number) }}" method="POST" style="display: none;">
        </form>
        {% endif %}
    </div>
</div>

{% if order.status in ['pending_pickup_selection', 'confirmed', 'cancelled'] %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var deleteBtn = document.getElementById('deleteOrderBtn');
    if (deleteBtn) {
        deleteBtn.addEventListener('click', function() {
            var confirmationMessage = "√ätes-vous s√ªr de vouloir supprimer d√©finitivement votre commande ?\n\n";
            confirmationMessage += "Cette action est irr√©versible. Cela peut √©galement √™tre emb√™tant pour nos producteurs partenaires et perturber la logistique de pr√©paration. Merci de votre compr√©hension.";
            
            if (window.confirm(confirmationMessage)) {
                document.getElementById('deleteOrderForm').submit();
            }
        });
    }
});
</script>
{% endif %}

{% endblock %}
